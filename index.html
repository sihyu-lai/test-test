<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3å¤©è¦ªå­äº’å‹•å°æ—¥è¨˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Firebase Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, setLogLevel, collection, getDocs, query, where, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // This is a special, hard-coded Admin ID for demonstration.
        // In a real application, you would use a more robust authentication system.
        const ADMIN_ID = "admin-Shopping";

        // Initialize Firebase services
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Set Firebase log level for debugging
        setLogLevel('Debug');

        let currentUserId = null; // The internal Firebase UID
        let currentUserSimpleId = null; // The simplified ID for display
        let unsubscribe = null;
        let isAdmin = false;
        let isInitialized = false;

        async function createOrGetSimpleId(uid) {
            if (!auth.currentUser) {
                console.error("Firestore operation denied: User not authenticated.");
                return null;
            }
            const userRef = doc(db, `artifacts/${appId}/public/data/user_profiles`, uid);
            try {
                const userSnap = await getDoc(userRef);
                if (userSnap.exists() && userSnap.data().simpleId) {
                    return userSnap.data().simpleId;
                } else {
                    const newSimpleId = Math.random().toString(36).substring(2, 8); // A short, random alphanumeric string
                    await setDoc(userRef, { simpleId: newSimpleId, uid: uid }, { merge: true });
                    return newSimpleId;
                }
            } catch (e) {
                console.error("Error creating or getting simple ID:", e);
                throw e; // Propagate the error
            }
        }
        
        // Helper function to get Firebase UID from simple ID
        async function getUidFromSimpleId(simpleId) {
            if (!auth.currentUser) {
                console.error("Firestore operation denied: User not authenticated.");
                return null;
            }
            const usersRef = collection(db, `artifacts/${appId}/public/data/user_profiles`);
            const q = query(usersRef, where("simpleId", "==", simpleId));
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) {
                return querySnapshot.docs[0].id;
            }
            return null;
        }
        
        function updateUIState(state) {
            const userIdDisplay = document.getElementById('user-id-display');
            const currentViewingIdEl = document.getElementById('current-viewing-id');
            const mainContent = document.getElementById('main-content');
            const loadingMessage = document.getElementById('loading-message');

            if (state === 'loading') {
                userIdDisplay.textContent = `æ­£åœ¨è¼‰å…¥ä½¿ç”¨è€… ID...`;
                loadingMessage.classList.remove('hidden');
                mainContent.classList.add('hidden');
            } else if (state === 'loaded') {
                userIdDisplay.textContent = `ä½ çš„ä½¿ç”¨è€… ID: ${currentUserSimpleId} ${isAdmin ? '(ç®¡ç†è€…)' : ''}`;
                currentViewingIdEl.textContent = `ç›®å‰æ­£åœ¨æª¢è¦–çš„ ID: ${currentUserSimpleId}`;
                loadingMessage.classList.add('hidden');
                mainContent.classList.remove('hidden');
            } else if (state === 'error') {
                userIdDisplay.textContent = `è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚`;
                loadingMessage.classList.add('hidden');
                mainContent.classList.add('hidden');
            }
        }

        // Authenticate the user and set up the main logic
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                try {
                    currentUserSimpleId = await createOrGetSimpleId(currentUserId);
                    isAdmin = (currentUserSimpleId === ADMIN_ID);

                    if (isAdmin) {
                        document.getElementById('admin-section').classList.remove('hidden');
                        document.getElementById('share-view').classList.add('hidden');
                        document.getElementById('user-diary-view').classList.add('hidden');
                        loadAllUsers();
                    } else {
                        document.getElementById('admin-section').classList.add('hidden');
                        document.getElementById('share-view').classList.remove('hidden');
                        document.getElementById('user-diary-view').classList.remove('hidden');
                        initApp(currentUserId, currentUserSimpleId);
                    }
                    updateUIState('loaded');
                } catch (e) {
                console.error("Initialization failed:", e);
                    updateUIState('error');
                }
            } else {
                // User is not signed in, so we sign them in here
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Authentication failed:", error);
                    updateUIState('error');
                }
            }
        });
        
        // This part is now outside the initApp function
        const expandableContent = document.getElementById('expandable-content');
        const toggleBtn = document.getElementById('toggle-instructions');
        if (toggleBtn && expandableContent) {
            toggleBtn.addEventListener('click', () => {
                const isExpanded = expandableContent.classList.contains('max-h-screen');
                if (isExpanded) {
                    expandableContent.classList.remove('max-h-screen');
                    toggleBtn.textContent = 'é–±è®€æ›´å¤š â–¼';
                } else {
                    expandableContent.classList.add('max-h-screen');
                    toggleBtn.textContent = 'æ”¶èµ· â–²';
                }
            });
        }

        async function loadAllUsers() {
            if (!auth.currentUser) {
                console.error("Firestore operation denied: User not authenticated.");
                return;
            }
            console.log("Admin mode: Loading all user diaries.");
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = `<p class="text-center text-gray-500">æ­£åœ¨è¼‰å…¥æ‰€æœ‰ä½¿ç”¨è€…...</p>`;

            const usersRef = collection(db, `artifacts/${appId}/public/data/user_profiles`);
            
            const querySnapshot = await getDocs(usersRef);
            
            usersList.innerHTML = ''; // Clear loading message

            if (querySnapshot.empty) {
                usersList.innerHTML = `<p class="text-center text-gray-500">ç›®å‰æ²’æœ‰ä»»ä½•æ—¥è¨˜ã€‚</p>`;
            } else {
                querySnapshot.forEach(doc => {
                    const userSimpleId = doc.data().simpleId;
                    const userItem = document.createElement('li');
                    userItem.className = "p-3 border rounded-lg hover:bg-stone-100 cursor-pointer transition text-center break-all";
                    userItem.textContent = `ä½¿ç”¨è€… ID: ${userSimpleId}`;
                    userItem.addEventListener('click', async () => {
                        const uid = doc.id; // Use the Firebase UID as the document ID
                        initApp(uid, userSimpleId);
                        document.getElementById('switch-back-btn').classList.remove('hidden');
                    });
                    usersList.appendChild(userItem);
                });
            }
        }

        function initApp(userIdToLoad, simpleIdToDisplay) {
            console.log(`Loading diary for user ID: ${userIdToLoad}`);

            const diaryData = [
                { day: 1, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©è®“ä½ æœ€é–‹å¿ƒçš„äº‹æƒ…æ˜¯ä»€éº¼ï¼Ÿ' },
                { day: 2, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©çš„åˆé¤æœ€å¥½åƒçš„æ˜¯å“ªä¸€é“ï¼Ÿç‚ºä»€éº¼ï¼Ÿ' },
                { day: 3, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©åœ¨å­¸æ ¡ç™¼ç”Ÿä¸€ä»¶æœ‰è¶£çš„å°äº‹ï¼Ÿ' }
            ];

            const encouragingWords = [
                "å¤ªæ£’äº†ï¼ä»Šå¤©ä¹Ÿå®Œæˆäº†æŒ‘æˆ°ï¼",
                "ä½ çœŸæ£’ï¼åˆé›¢ç›®æ¨™æ›´è¿‘ä¸€æ­¥äº†ï¼",
                "æ—¥è¨˜å¯«å¾—çœŸå¥½ï¼Œç‚ºä½ æ‹æ‹æ‰‹ï¼",
                "å“‡ï¼ä½ æ¯å¤©éƒ½åœ¨é€²æ­¥å‘¢ï¼",
                "ç¹¼çºŒåŠ æ²¹ï¼ŒæœŸå¾…ä½ æ˜å¤©çš„æ—¥è¨˜ï¼"
            ];
            
            const diaryGrid = document.getElementById('diary-grid');
            const modal = document.getElementById('modal');
            const completionModal = document.getElementById('completion-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal');
            const completedDaysEl = document.getElementById('completed-days');
            const progressPercentageEl = document.getElementById('progress-percentage');
            const progressBarEl = document.getElementById('progress-bar');
            const toast = document.getElementById('toast');
            const loadIdInput = document.getElementById('load-id-input');
            const loadIdBtn = document.getElementById('load-id-btn');
            const switchBackBtn = document.getElementById('switch-back-btn');
            const currentViewingIdEl = document.getElementById('current-viewing-id');

            document.getElementById('share-view').classList.remove('hidden');
            document.getElementById('user-diary-view').classList.remove('hidden');
            document.getElementById('admin-section').classList.add('hidden'); // Ensure admin section is hidden
            document.getElementById('current-viewing-id').textContent = `ç›®å‰æ­£åœ¨æª¢è¦–çš„ ID: ${simpleIdToDisplay}`;

            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('opacity-100');
                setTimeout(() => {
                    toast.classList.remove('opacity-100');
                }, 3000);
            }
            
            async function saveEntry(day, content, image) {
                if (!auth.currentUser) {
                    showToast("èº«ä»½é©—è­‰å¤±æ•—ï¼Œè«‹é‡è©¦ã€‚");
                    return;
                }
                if (userIdToLoad !== currentUserId) {
                    showToast("ä½ æ²’æœ‰æ¬Šé™ä¿®æ”¹å…¶ä»–äººçš„æ—¥è¨˜ï¼");
                    return;
                }
                const diaryRef = doc(db, `artifacts/${appId}/public/data/diaries`, userIdToLoad);
                let entriesToSave = { ...entries };
                entriesToSave[day] = { text: content, image: image, timestamp: Date.now() };

                try {
                    await setDoc(diaryRef, entriesToSave);
                    console.log(`Entry for day ${day} saved successfully.`);

                    if (content.trim() !== '' || image) {
                        if (day === 3) {
                            closeModal();
                            completionModal.classList.remove('hidden');
                        } else {
                            const randomMessage = encouragingWords[Math.floor(Math.random() * encouragingWords.length)];
                            showToast(randomMessage);
                        }
                    }
                } catch (e) {
                    console.error("Error saving document: ", e);
                }
            }

            // Real-time listener for the current user's diary
            if (unsubscribe) {
                unsubscribe();
            }

            const diaryRef = doc(db, `artifacts/${appId}/public/data/diaries`, userIdToLoad);
            let entries = {};

            unsubscribe = onSnapshot(diaryRef, (snapshot) => {
                if (snapshot.exists()) {
                    entries = snapshot.data() || {};
                    renderGrid();
                    updateProgressDisplay();
                    console.log("Entries updated from Firestore.");
                } else {
                    console.log("No diary data found. Initializing new entries.");
                    entries = {};
                    renderGrid();
                    updateProgressDisplay();
                }
            }, (error) => {
                console.error("Error listening to Firestore:", error);
            });

            function updateProgressDisplay() {
                const completedCount = Object.values(entries).filter(entry => entry.text && entry.text.trim() !== '' || entry.image).length;
                const totalDays = diaryData.length;
                const percentage = totalDays > 0 ? Math.round((completedCount / totalDays) * 100) : 0;

                completedDaysEl.textContent = `${completedCount} / ${totalDays} å¤©`;
                progressPercentageEl.textContent = `${percentage}%`;
                progressBarEl.style.width = `${percentage}%`;
            }

            function renderGrid() {
                diaryGrid.innerHTML = '';
                diaryData.forEach(item => {
                    const entry = entries[item.day] || {};
                    const hasContent = (entry.text && entry.text.trim() !== '') || entry.image;
                    const hasImage = entry.image;

                    const card = document.createElement('div');
                    card.className = `h-28 md:h-32 w-28 md:w-32 rounded-lg cursor-pointer flex-shrink-0 flex justify-center items-center shadow-md transition-transform transform hover:scale-105 relative ${hasContent ? 'completed' : ''} ${hasImage ? 'has-image' : ''}`;
                    card.dataset.day = item.day;
                    card.innerHTML = `
                        <div class="card-front w-full h-full bg-amber-100 border-2 border-amber-200 text-amber-800 flex flex-col justify-center items-center rounded-lg p-2">
                            <span class="text-xs">ç¬¬</span>
                            <span class="text-4xl font-bold">${item.day}</span>
                            <span class="text-xs">å¤©</span>
                        </div>
                    `;
                    if (hasImage) {
                        const imageIcon = document.createElement('div');
                        imageIcon.className = `absolute top-2 right-2 text-xl`;
                        imageIcon.innerHTML = 'ğŸ–¼ï¸';
                        card.querySelector('.card-front').appendChild(imageIcon);
                    }
                    card.addEventListener('click', () => openModal(item));
                    diaryGrid.appendChild(card);
                });
            }

            function openModal(dayData) {
                const entry = entries[dayData.day] || {};
                const entryText = entry.text || '';
                const entryImage = entry.image || '';
                const isViewingOwnDiary = userIdToLoad === currentUserId;

                modalContent.innerHTML = `
                    <div class="text-center mb-4">
                        <span class="text-sm bg-amber-100 text-amber-800 px-3 py-1 rounded-full">${dayData.theme}</span>
                        <h3 class="text-2xl font-bold mt-2 text-amber-900">ç¬¬ ${dayData.day} å¤©</h3>
                    </div>
                    <p class="text-lg text-center text-gray-700 mb-4">${dayData.prompt}</p>
                    <div class="bg-amber-50 p-4 rounded-lg border border-amber-200 mb-4">
                        <p class="text-sm text-amber-700 text-center">è¼•é¬†è¨˜éŒ„ï¼Œå…©ç¨®æ–¹å¼ä»»ä½ é¸ï¼</p>
                        <ul class="list-none text-sm text-amber-800 space-y-2 mt-2">
                            <li>1. ç•«ä¸‹ä¾†æˆ–å¯«åœ¨ç´™ä¸Šï¼š æ‹å¼µç…§ç‰‡ï¼Œç›´æ¥é»é¸ä¸‹æ–¹ä¸Šå‚³åœ–ç‰‡ã€‚</li>
                            <li>2. ç›´æ¥æ‰“å­—ï¼š åœ¨ä¸‹æ–¹ç©ºæ ¼ä¸­ï¼Œè¼¸å…¥ä½ çš„å¿ƒæƒ…æˆ–æ—¥è¨˜å…§å®¹ã€‚</li>
                        </ul>
                    </div>
                    ${isViewingOwnDiary ? '' : '<p class="bg-stone-200 text-stone-700 p-2 rounded-lg text-sm text-center mb-4">é€™ä»½æ—¥è¨˜æ˜¯å”¯è®€çš„ï¼Œä½ æ²’æœ‰æ¬Šé™ä¿®æ”¹ã€‚</p>'}
                    <div id="image-preview" class="mb-4">
                        ${entryImage ? `<img src="${entryImage}" class="w-full h-auto rounded-lg shadow-md mb-2 object-contain" alt="æ—¥è¨˜åœ–ç‰‡é è¦½">` : ''}
                    </div>
                    <div class="mb-4 flex flex-col items-start space-y-2">
                        <label for="image-upload" class="bg-amber-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer hover:bg-amber-700 transition duration-300 text-sm ${isViewingOwnDiary ? '' : 'hidden'}">
                            ä¸Šå‚³åœ–ç‰‡
                        </label>
                        <input type="file" id="image-upload" accept="image/*" class="hidden">
                    </div>
                    <textarea id="diary-entry-${dayData.day}" class="w-full h-48 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition ${isViewingOwnDiary ? '' : 'bg-gray-100 cursor-not-allowed'}" placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ çš„å°æ—¥è¨˜..." ${isViewingOwnDiary ? '' : 'readonly'}>${entryText}</textarea>
                    <div class="mt-4 flex justify-end">
                        <button id="save-btn" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-amber-700 transition duration-300 ${isViewingOwnDiary ? '' : 'hidden'}">å„²å­˜</button>
                    </div>
                `;
                modal.classList.remove('hidden');

                const imageUpload = document.getElementById('image-upload');
                const imagePreviewDiv = document.getElementById('image-preview');
                let uploadedImageBase64 = entryImage;

                imageUpload.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            uploadedImageBase64 = e.target.result;
                            imagePreviewDiv.innerHTML = `<img src="${uploadedImageBase64}" class="w-full h-auto rounded-lg shadow-md mb-2 object-contain" alt="æ—¥è¨˜åœ–ç‰‡é è¦½">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });

                const textarea = document.getElementById(`diary-entry-${dayData.day}`);
                textarea.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                    }
                });

                const saveBtn = document.getElementById('save-btn');
                saveBtn.onclick = () => {
                    textarea.blur();
                    saveEntry(dayData.day, textarea.value, uploadedImageBase64);
                    
                    if (dayData.day !== 3) {
                        closeModal();
                    } else {
                        closeModal();
                    }
                };
            }

            loadIdBtn.addEventListener('click', async () => {
                const newSimpleId = loadIdInput.value.trim();
                if (newSimpleId) {
                    const newUid = await getUidFromSimpleId(newSimpleId);
                    if (newUid) {
                        initApp(newUid, newSimpleId);
                        document.getElementById('switch-back-btn').classList.remove('hidden');
                    } else {
                        showToast("æ‰¾ä¸åˆ°è©²ä½¿ç”¨è€… IDï¼Œè«‹ç¢ºèªå¾Œå†è©¦ã€‚");
                    }
                } else {
                    showToast("è«‹è¼¸å…¥æœ‰æ•ˆçš„ä½¿ç”¨è€… IDã€‚");
                }
            });

            switchBackBtn.addEventListener('click', () => {
                initApp(currentUserId, currentUserSimpleId);
                document.getElementById('switch-back-btn').classList.add('hidden');
            });

            function closeModal() {
                modal.classList.add('hidden');
            }
            
            function closeCompletionModal() {
                completionModal.classList.add('hidden');
            }

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            completionModal.addEventListener('click', (e) => {
                if (e.target === completionModal || e.target.tagName === 'A') {
                    closeCompletionModal();
                }
            });
        }
    </script>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF5;
            color: #5D4037;
        }
        .diary-card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .diary-card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .completed .card-front {
            background-color: #A5D6A7;
            color: #1B5E20;
            border-color: #66BB6A;
        }
        .has-image .card-front {
            background-color: #E6EE9C;
            border-color: #DCE775;
            color: #33691E;
        }
    </style>
</head>
<body class="antialiased">
    <div id="loading-message" class="fixed inset-0 bg-white bg-opacity-70 flex items-center justify-center z-50">
        <div class="text-center p-4 rounded-lg">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-amber-500 border-t-transparent mb-4"></div>
            <p class="text-xl font-semibold text-amber-700">æ­£åœ¨è¼‰å…¥ä½¿ç”¨è€… ID...</p>
        </div>
    </div>
    <div id="main-content" class="container mx-auto px-4 py-8 md:py-12 max-w-5xl hidden">
        <header class="text-center mb-8">
            <img src="https://cms-static.cdn.91app.com/images/original/41627/c15f8b26-e944-465d-98c1-2e79eb4bac59-1754966050-mijvui6ja7_d.png" alt="è¦ªå­å¤©ä¸‹è³¼ç‰©å•†æ¨™" class="mx-auto mb-4 w-64 h-auto object-contain">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-800">3å¤©è¦ªå­äº’å‹•å°æ—¥è¨˜</h1>
            <p class="mt-2 text-lg text-amber-700">è®“å­©å­æ¯å¤©ç·´ç¿’ï¼Œå°æ—¥è¨˜è¶…è¼•é¬†ã€‚</p>
        </header>

        <section id="user-info" class="bg-gray-100 border border-gray-300 rounded-lg p-4 mb-8 text-center text-sm text-gray-600 break-all">
            <p id="user-id-display" class="font-bold">ä½ çš„ä½¿ç”¨è€… ID: è¼‰å…¥ä¸­...</p>
            <p id="current-viewing-id" class="mt-4 font-semibold text-gray-700">ç›®å‰æ­£åœ¨æª¢è¦–çš„ ID: è¼‰å…¥ä¸­...</p>
        </section>

        <section id="admin-section" class="bg-rose-50 border border-rose-200 rounded-lg p-6 mb-10 shadow-sm hidden">
            <h2 class="text-2xl font-bold text-rose-900 mb-4">ç®¡ç†è€…æ¨¡å¼ï¼šæª¢è¦–æ‰€æœ‰ä½¿ç”¨è€…æ—¥è¨˜</h2>
            <p class="mb-4 text-rose-800 text-sm">èº«ç‚ºç®¡ç†è€…ï¼Œä½ å¯ä»¥ç›´æ¥é»æ“Šä»»ä½•ä¸€å€‹ä½¿ç”¨è€… ID ä¾†æŸ¥çœ‹ä»–å€‘çš„æ—¥è¨˜ã€‚</p>
            <ul id="users-list" class="space-y-4 max-h-64 overflow-y-auto">
                <p class="text-center text-gray-500">æ­£åœ¨è¼‰å…¥æ‰€æœ‰ä½¿ç”¨è€…...</p>
            </ul>
        </section>

        <section id="user-diary-view" class="hidden">
            <section id="progress-section" class="bg-amber-100 border border-amber-300 rounded-lg p-6 mb-10 shadow-sm">
                <h2 class="text-2xl font-bold text-amber-900 mb-4">æŒ‘æˆ°é€²åº¦</h2>
                <div class="flex flex-col md:flex-row items-center md:justify-between space-y-4 md:space-y-0 md:space-x-8">
                    <div class="flex-1 w-full">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xl font-semibold text-amber-800">å·²å®Œæˆå¤©æ•¸</span>
                            <span id="completed-days" class="text-2xl font-bold text-amber-800">0 / 3 å¤©</span>
                        </div>
                        <div class="w-full bg-amber-200 rounded-full h-4 relative overflow-hidden">
                            <div id="progress-bar" class="bg-amber-600 h-full rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="text-center md:text-right">
                        <span id="progress-percentage" class="text-4xl font-extrabold text-amber-800">0%</span>
                        <p class="text-sm text-amber-700 mt-1">æŒ‘æˆ°é€²åº¦</p>
                    </div>
                </div>
            </section>

            <section id="instructions" class="bg-amber-50 border border-amber-200 rounded-lg p-6 mb-10 shadow-sm">
                <h2 class="text-2xl font-bold mb-4 text-amber-900 flex items-center">
                    <span class="text-3xl mr-3">ğŸ’¡</span> çµ¦çˆ¸åª½çš„æº«é¦¨å°æé†’
                </h2>
                <div class="space-y-3 text-amber-800 text-base md:text-lg">
                    <p>é€™ä¸åƒ…æ˜¯ä¸€ä»½æ—¥è¨˜æ¸…å–®ï¼Œæ›´æ˜¯ä¸€å€‹é–‹å•Ÿè¦ªå­å°è©±çš„é­”æ³•å·¥å…·ã€‚æˆ‘å€‘å°‡éœæ…‹çš„å­¸ç¿’å–®è¨­è¨ˆæˆä¸€å€‹å……æ»¿é©šå–œçš„äº’å‹•ç¶²é ï¼Œè®“å­©å­æ¯å¤©éƒ½èƒ½ã€Œç¿»ã€é–‹ä¸€å€‹æ–°å•é¡Œï¼Œåƒç©éŠæˆ²ä¸€æ¨£ï¼Œè¼•é¬†æ„‰å¿«åœ°é¤Šæˆè¨˜éŒ„ç”Ÿæ´»çš„å¥½ç¿’æ…£ã€‚</p>
                    <div id="expandable-content" class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                        <ul class="list-disc list-inside pl-2 space-y-2 mt-4">
                            <li>æŒ‘ä¸€å€‹è¼•é¬†æ™‚åˆ»ï¼š æ¯å¤©æ™šé¤å¾Œæˆ–ç¡å‰ï¼Œæ‰¾å€‹èˆ’é©çš„è§’è½ï¼Œå’Œå­©å­ä¸€èµ·èŠèŠä»Šå¤©ã€‚</li>
                            <li>ä¸è¦æ±‚å­—æ•¸ï¼š å­©å­å¯«å¤šå¯«å°‘éƒ½æ²’é—œä¿‚ï¼Œé‡é»æ˜¯è®“ä»–å€‘äº«å—åˆ†äº«çš„éç¨‹ã€‚</li>
                            <li>é¼“å‹µé‡æ–¼è¦æ±‚ï¼š å¯«å‡ºä¾†çš„æ¯ä¸€å€‹å­—éƒ½å€¼å¾—è¢«è‚¯å®šï¼Œè®“å­©å­è¦ºå¾—å¯«æ—¥è¨˜æ˜¯ä»¶é–‹å¿ƒçš„äº‹ã€‚</li>
                        </ul>
                        <p class="pt-4">é»æ“Šä¸‹æ–¹çš„æ•¸å­—å¡ç‰‡ï¼Œé–‹å§‹ä»Šå¤©çš„æ—¥è¨˜å†’éšªå§ï¼å…§å®¹èˆ‡åœ–ç‰‡æœƒè‡ªå‹•å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚</p>
                    </div>
                    <button id="toggle-instructions" class="mt-4 text-amber-600 hover:text-amber-800 font-semibold flex items-center">
                        é–±è®€æ›´å¤š â–¼
                    </button>
                </div>
            </section>

            <main id="diary-grid" class="flex flex-wrap justify-center gap-8 mb-10">
            </main>

            <section id="share-view" class="bg-stone-50 border border-stone-200 rounded-lg p-6 mb-10 shadow-sm hidden">
                <h2 class="text-2xl font-bold text-stone-800 mb-4">èˆ‡ä»–äººåˆ†äº«æˆ–æŸ¥çœ‹æ—¥è¨˜</h2>
                <p class="text-stone-700 mb-4">ä½ å¯ä»¥å°‡è‡ªå·±çš„ ID åˆ†äº«çµ¦ä»–äººï¼Œæˆ–è¼¸å…¥ä»–äººçš„ ID ä¾†æŸ¥çœ‹ä»–å€‘çš„å°æ—¥è¨˜ã€‚</p>
                <div class="flex flex-col md:flex-row gap-4 items-stretch md:items-center">
                    <input type="text" id="load-id-input" placeholder="è«‹åœ¨é€™è£¡è²¼ä¸Šæˆ–è¼¸å…¥å…¶ä»–äººçš„ ID..." class="flex-1 p-3 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-400 transition">
                    <button id="load-id-btn" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 w-full md:w-auto">è¼‰å…¥æ—¥è¨˜</button>
                </div>
                <button id="switch-back-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 w-full hidden">åˆ‡æ›å›æˆ‘çš„æ—¥è¨˜</button>
            </section>
        </section>

        <!-- General Modal for Diary Entry -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col p-6 relative">
                <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                <div id="modal-content" class="overflow-y-auto">
                </div>
            </div>
        </div>
        
        <!-- Special Modal for Day 3 Completion -->
        <div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden z-50">
            <div class="bg-gradient-to-br from-yellow-100 via-white to-green-100 rounded-2xl shadow-2xl w-full max-w-lg flex flex-col p-8 relative border-4 border-yellow-400">
                <div class="text-center">
                    <div class="text-6xl mb-4 animate-bounce">ğŸ‰</div>
                    <h3 class="text-4xl font-bold text-yellow-800 mb-2">æ­å–œä½ ï¼</h3>
                    <p class="text-2xl font-semibold text-gray-800 mb-4">æˆåŠŸå®Œæˆ3å¤©å°æ—¥è¨˜æŒ‘æˆ°ï¼</p>
                    <p class="text-lg text-gray-600 mb-6">é€™ä»½å …æŒèˆ‡åŠªåŠ›å€¼å¾—å˜‰çï¼Œä½ çœŸçš„å¤ªæ£’äº†ï¼</p>
                    <img src="https://cms-static.cdn.91app.com/images/original/41627/c15f8b26-e944-465d-98c1-2e79eb4bac59-1754966050-mijvui6ja7_d.png" alt="è¦ªå­å¤©ä¸‹è³¼ç‰©å•†æ¨™" class="mx-auto my-4 w-48 h-auto object-contain">
                    <a id="coupon-link" href="https://bmai.app/fbc05a7d" class="inline-block bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">
                        é ˜å–ä½ çš„å°ˆå±¬å°ç¦®ç‰©ï¼
                    </a>
                </div>
            </div>
        </div>

        <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-amber-600 text-white text-center py-3 px-6 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
        </div>
    </div>
</body>
</html>
