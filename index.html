<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3å¤©è¦ªå­äº’å‹•å°æ—¥è¨˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cozy Storytime -->
    <!-- Application Structure Plan: The app uses a responsive grid of 30 cards, each representing a day. Clicking a card opens a modal where users can write their diary entry and also upload an image. A new section is added at the top to display a progress bar and statistics (days completed, percentage) to gamify the experience and provide a clear sense of progress. The app saves both the text and the image (converted to Base64) to localStorage. A new feature has been added to provide encouraging messages after a successful save. The flow remains simple: click, add content (text/photo), save, see the card and progress bar update, and receive a motivational message. For day 30, a special modal with a reward link is shown. -->
    <!-- Visualization & Content Choices: Report Info: 30 daily prompts, user-uploaded images, and progress tracking. Goal: Organize prompts, allow interactive multimedia entries, show challenge progress, and motivate the user. Viz/Presentation Method: An HTML/CSS grid of clickable cards and a new progress dashboard with a horizontal progress bar. A simple toast-like notification is used for encouragement messages. A special modal is used for the Day 30 reward. Interaction: On-click reveal of modal, text input, file selection, and save logic. The save function now updates both the card display, the progress dashboard, and triggers the encouragement message or the special Day 30 reward modal. Justification: The encouragement messages directly address the user's request, adding a positive reinforcement loop that is especially effective for children. The special modal for Day 30 gamifies the final step, making the reward feel more significant. Library/Method: Vanilla JS for all logic and event handling, Tailwind CSS for all styling, FileReader for Base64 conversion. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF5;
            color: #5D4037;
        }
        .diary-card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .diary-card.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .completed .card-front {
            background-color: #A5D6A7;
            color: #1B5E20;
            border-color: #66BB6A;
        }
        .has-image .card-front {
            background-color: #E6EE9C;
            border-color: #DCE775;
            color: #33691E;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8 md:py-12 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-800">3å¤©è¦ªå­äº’å‹•å°æ—¥è¨˜</h1>
            <p class="mt-2 text-lg text-amber-700">è®“å­©å­æ¯å¤©ç·´ç¿’ï¼Œå°æ—¥è¨˜è¶…è¼•é¬†ã€‚</p>
        </header>

        <section id="progress-section" class="bg-amber-100 border border-amber-300 rounded-lg p-6 mb-10 shadow-sm">
            <h2 class="text-2xl font-bold text-amber-900 mb-4">æŒ‘æˆ°é€²åº¦</h2>
            <div class="flex flex-col md:flex-row items-center md:justify-between space-y-4 md:space-y-0 md:space-x-8">
                <div class="flex-1 w-full">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-xl font-semibold text-amber-800">å·²å®Œæˆå¤©æ•¸</span>
                        <span id="completed-days" class="text-2xl font-bold text-amber-800">0 / 3 å¤©</span>
                    </div>
                    <div class="w-full bg-amber-200 rounded-full h-4 relative overflow-hidden">
                        <div id="progress-bar" class="bg-amber-600 h-full rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="text-center md:text-right">
                    <span id="progress-percentage" class="text-4xl font-extrabold text-amber-800">0%</span>
                    <p class="text-sm text-amber-700 mt-1">æŒ‘æˆ°é€²åº¦</p>
                </div>
            </div>
        </section>

        <section id="instructions" class="bg-amber-50 border border-amber-200 rounded-lg p-6 mb-10 shadow-sm">
            <h2 class="text-2xl font-bold mb-4 text-amber-900 flex items-center">
                <span class="text-3xl mr-3">ğŸ’¡</span> çµ¦çˆ¸åª½çš„æº«é¦¨å°æé†’
            </h2>
            <div class="space-y-3 text-amber-800 text-base md:text-lg">
                <p>é€™ä¸åƒ…æ˜¯ä¸€ä»½æ—¥è¨˜æ¸…å–®ï¼Œæ›´æ˜¯ä¸€å€‹é–‹å•Ÿè¦ªå­å°è©±çš„é­”æ³•å·¥å…·ã€‚æˆ‘å€‘å°‡éœæ…‹çš„å­¸ç¿’å–®è¨­è¨ˆæˆä¸€å€‹å……æ»¿é©šå–œçš„äº’å‹•ç¶²é ï¼Œè®“å­©å­æ¯å¤©éƒ½èƒ½ã€Œç¿»ã€é–‹ä¸€å€‹æ–°å•é¡Œï¼Œåƒç©éŠæˆ²ä¸€æ¨£ï¼Œè¼•é¬†æ„‰å¿«åœ°é¤Šæˆè¨˜éŒ„ç”Ÿæ´»çš„å¥½ç¿’æ…£ã€‚</p>
                <div id="expandable-content" class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                    <ul class="list-disc list-inside pl-2 space-y-2 mt-4">
                        <li>æŒ‘ä¸€å€‹è¼•é¬†æ™‚åˆ»ï¼š æ¯å¤©æ™šé¤å¾Œæˆ–ç¡å‰ï¼Œæ‰¾å€‹èˆ’é©çš„è§’è½ï¼Œå’Œå­©å­ä¸€èµ·èŠèŠä»Šå¤©ã€‚</li>
                        <li>ä¸è¦æ±‚å­—æ•¸ï¼š å­©å­å¯«å¤šå¯«å°‘éƒ½æ²’é—œä¿‚ï¼Œé‡é»æ˜¯è®“ä»–å€‘äº«å—åˆ†äº«çš„éç¨‹ã€‚</li>
                        <li>é¼“å‹µé‡æ–¼è¦æ±‚ï¼š å¯«å‡ºä¾†çš„æ¯ä¸€å€‹å­—éƒ½å€¼å¾—è¢«è‚¯å®šï¼Œè®“å­©å­è¦ºå¾—å¯«æ—¥è¨˜æ˜¯ä»¶é–‹å¿ƒçš„äº‹ã€‚</li>
                    </ul>
                    <p class="pt-4">é»æ“Šä¸‹æ–¹çš„æ•¸å­—å¡ç‰‡ï¼Œé–‹å§‹ä»Šå¤©çš„æ—¥è¨˜å†’éšªå§ï¼å…§å®¹èˆ‡åœ–ç‰‡æœƒè‡ªå‹•å„²å­˜åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚</p>
                </div>
                <button id="toggle-instructions" class="mt-4 text-amber-600 hover:text-amber-800 font-semibold flex items-center">
                    é–±è®€æ›´å¤š â–¼
                </button>
            </div>
        </section>

        <main id="diary-grid" class="flex flex-wrap justify-center gap-8">
        </main>

        <!-- General Modal for Diary Entry -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden z-50">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col p-6 relative">
                <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
                <div id="modal-content" class="overflow-y-auto">
                </div>
            </div>
        </div>
        
        <!-- Special Modal for Day 3 Completion -->
        <div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center p-4 hidden z-50">
            <div class="bg-gradient-to-br from-yellow-100 via-white to-green-100 rounded-2xl shadow-2xl w-full max-w-lg flex flex-col p-8 relative border-4 border-yellow-400">
                <div class="text-center">
                    <div class="text-6xl mb-4 animate-bounce">ğŸ‰</div>
                    <h3 class="text-4xl font-bold text-yellow-800 mb-2">æ­å–œä½ ï¼</h3>
                    <p class="text-2xl font-semibold text-gray-800 mb-4">æˆåŠŸå®Œæˆ3å¤©å°æ—¥è¨˜æŒ‘æˆ°ï¼</p>
                    <p class="text-lg text-gray-600 mb-6">é€™ä»½å …æŒèˆ‡åŠªåŠ›å€¼å¾—å˜‰çï¼Œä½ çœŸçš„å¤ªæ£’äº†ï¼</p>
                    <img src="https://cms-static.cdn.91app.com/images/original/41627/c15f8b26-e944-465d-98c1-2e79eb4bac59-1754966050-mijvui6ja7_d.png" alt="è¦ªå­å¤©ä¸‹è³¼ç‰©å•†æ¨™" class="mx-auto my-4 w-48 h-auto object-contain">
                    <a id="coupon-link" href="https://bmai.app/fbc05a7d" class="inline-block bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">
                        é ˜å–ä½ çš„å°ˆå±¬å°ç¦®ç‰©ï¼
                    </a>
                </div>
            </div>
        </div>

        <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-amber-600 text-white text-center py-3 px-6 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
        </div>
    </div>

    <script>
        const diaryData = [
            { day: 1, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©è®“ä½ æœ€é–‹å¿ƒçš„äº‹æƒ…æ˜¯ä»€éº¼ï¼Ÿ' },
            { day: 2, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©çš„åˆé¤æœ€å¥½åƒçš„æ˜¯å“ªä¸€é“ï¼Ÿç‚ºä»€éº¼ï¼Ÿ' },
            { day: 3, theme: 'å¾æ—¥å¸¸é–‹å§‹', prompt: 'ä»Šå¤©åœ¨å­¸æ ¡ç™¼ç”Ÿä¸€ä»¶æœ‰è¶£çš„å°äº‹ï¼Ÿ' }
        ];
        
        const encouragingWords = [
            "å¤ªæ£’äº†ï¼ä»Šå¤©ä¹Ÿå®Œæˆäº†æŒ‘æˆ°ï¼",
            "ä½ çœŸæ£’ï¼åˆé›¢ç›®æ¨™æ›´è¿‘ä¸€æ­¥äº†ï¼",
            "æ—¥è¨˜å¯«å¾—çœŸå¥½ï¼Œç‚ºä½ æ‹æ‹æ‰‹ï¼",
            "å“‡ï¼ä½ æ¯å¤©éƒ½åœ¨é€²æ­¥å‘¢ï¼",
            "ç¹¼çºŒåŠ æ²¹ï¼ŒæœŸå¾…ä½ æ˜å¤©çš„æ—¥è¨˜ï¼"
        ];
        
        const diaryGrid = document.getElementById('diary-grid');
        const modal = document.getElementById('modal');
        const completionModal = document.getElementById('completion-modal');
        const modalContent = document.getElementById('modal-content');
        const closeModalBtn = document.getElementById('close-modal');
        const completedDaysEl = document.getElementById('completed-days');
        const progressPercentageEl = document.getElementById('progress-percentage');
        const progressBarEl = document.getElementById('progress-bar');
        const toast = document.getElementById('toast');
        const expandableContent = document.getElementById('expandable-content');
        const toggleBtn = document.getElementById('toggle-instructions');

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('opacity-100');
            setTimeout(() => {
                toast.classList.remove('opacity-100');
            }, 3000);
        }

        function loadEntries() {
            const entries = JSON.parse(localStorage.getItem('diaryEntries') || '{}');
            return entries;
        }

        function saveEntry(day, content, image) {
            const entries = loadEntries();
            entries[day] = { text: content, image: image };
            localStorage.setItem('diaryEntries', JSON.stringify(entries));
            
            if (content.trim() !== '' || image) {
                if (day === 3) {
                    closeModal(); // Close the regular modal first
                    completionModal.classList.remove('hidden');
                } else {
                    const randomMessage = encouragingWords[Math.floor(Math.random() * encouragingWords.length)];
                    showToast(randomMessage);
                }
            }
        }
        
        function openModal(dayData) {
            const entries = loadEntries();
            const entry = entries[dayData.day] || {};
            const entryText = entry.text || '';
            const entryImage = entry.image || '';

            modalContent.innerHTML = `
                <div class="text-center mb-4">
                    <span class="text-sm bg-amber-100 text-amber-800 px-3 py-1 rounded-full">${dayData.theme}</span>
                    <h3 class="text-2xl font-bold mt-2 text-amber-900">ç¬¬ ${dayData.day} å¤©</h3>
                </div>
                <p class="text-lg text-center text-gray-700 mb-4">${dayData.prompt}</p>
                <div class="bg-amber-50 p-4 rounded-lg border border-amber-200 mb-4">
                    <p class="text-sm text-amber-700 text-center">è¼•é¬†è¨˜éŒ„ï¼Œå…©ç¨®æ–¹å¼ä»»ä½ é¸ï¼</p>
                    <ul class="list-none text-sm text-amber-800 space-y-2 mt-2">
                        <li>1. ç•«ä¸‹ä¾†æˆ–å¯«åœ¨ç´™ä¸Šï¼š æ‹å¼µç…§ç‰‡ï¼Œç›´æ¥é»é¸ä¸‹æ–¹ä¸Šå‚³åœ–ç‰‡ã€‚</li>
                        <li>2. ç›´æ¥æ‰“å­—ï¼š åœ¨ä¸‹æ–¹ç©ºæ ¼ä¸­ï¼Œè¼¸å…¥ä½ çš„å¿ƒæƒ…æˆ–æ—¥è¨˜å…§å®¹ã€‚</li>
                    </ul>
                </div>
                <div id="image-preview" class="mb-4">
                    ${entryImage ? `<img src="${entryImage}" class="w-full h-auto rounded-lg shadow-md mb-2 object-contain" alt="æ—¥è¨˜åœ–ç‰‡é è¦½">` : ''}
                </div>
                <div class="mb-4 flex flex-col items-start space-y-2">
                    <label for="image-upload" class="bg-amber-600 text-white font-bold py-2 px-4 rounded-lg cursor-pointer hover:bg-amber-700 transition duration-300 text-sm">
                        ä¸Šå‚³åœ–ç‰‡
                    </label>
                    <input type="file" id="image-upload" accept="image/*" class="hidden">
                </div>
                <textarea id="diary-entry-${dayData.day}" class="w-full h-48 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition" placeholder="åœ¨é€™è£¡å¯«ä¸‹ä½ çš„å°æ—¥è¨˜...">${entryText}</textarea>
                <div class="mt-4 flex justify-end">
                    <button id="save-btn" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-amber-700 transition duration-300">å„²å­˜</button>
                </div>
            `;
            modal.classList.remove('hidden');

            const imageUpload = document.getElementById('image-upload');
            const imagePreviewDiv = document.getElementById('image-preview');
            let uploadedImageBase64 = entryImage;

            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImageBase64 = e.target.result;
                        imagePreviewDiv.innerHTML = `<img src="${uploadedImageBase64}" class="w-full h-auto rounded-lg shadow-md mb-2 object-contain" alt="æ—¥è¨˜åœ–ç‰‡é è¦½">`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            const textarea = document.getElementById(`diary-entry-${dayData.day}`);
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { // Prevents saving on simple Enter, allows for multiline with Shift+Enter
                    e.preventDefault();
                }
            });

            const saveBtn = document.getElementById('save-btn');
            saveBtn.onclick = () => {
                saveEntry(dayData.day, textarea.value, uploadedImageBase64);
                
                // Only close the modal and re-render if it's not Day 3
                if (dayData.day !== 3) {
                  closeModal();
                  renderGrid();
                  updateProgressDisplay();
                  const nextDayCard = document.querySelector(`[data-day="${dayData.day + 1}"]`);
                  if (nextDayCard) {
                      nextDayCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                } else {
                  // For Day 3, saving triggers the completion modal, so we close it here and let the other modal show up.
                  closeModal();
                  renderGrid();
                  updateProgressDisplay();
                }
            };
        }

        function closeModal() {
            modal.classList.add('hidden');
        }
        
        function closeCompletionModal() {
            completionModal.classList.add('hidden');
        }

        function updateProgressDisplay() {
            const entries = loadEntries();
            const completedCount = Object.values(entries).filter(entry => entry.text.trim() !== '' || entry.image).length;
            const totalDays = diaryData.length;
            const percentage = totalDays > 0 ? Math.round((completedCount / totalDays) * 100) : 0;

            completedDaysEl.textContent = `${completedCount} / ${totalDays} å¤©`;
            progressPercentageEl.textContent = `${percentage}%`;
            progressBarEl.style.width = `${percentage}%`;
        }

        function renderGrid() {
            const entries = loadEntries();
            diaryGrid.innerHTML = '';
            diaryData.forEach(item => {
                const entry = entries[item.day] || {};
                const hasContent = (entry.text && entry.text.trim() !== '') || entry.image;
                const hasImage = entry.image;

                const card = document.createElement('div');
                card.className = `h-28 md:h-32 w-28 md:w-32 rounded-lg cursor-pointer flex-shrink-0 flex justify-center items-center shadow-md transition-transform transform hover:scale-105 relative ${hasContent ? 'completed' : ''} ${hasImage ? 'has-image' : ''}`;
                card.dataset.day = item.day; // Add data-day attribute for easy selection
                card.innerHTML = `
                    <div class="card-front w-full h-full bg-amber-100 border-2 border-amber-200 text-amber-800 flex flex-col justify-center items-center rounded-lg p-2">
                        <span class="text-xs">ç¬¬</span>
                        <span class="text-4xl font-bold">${item.day}</span>
                        <span class="text-xs">å¤©</span>
                    </div>
                `;
                if (hasImage) {
                    const imageIcon = document.createElement('div');
                    imageIcon.className = `absolute top-2 right-2 text-xl`;
                    imageIcon.innerHTML = 'ğŸ–¼ï¸';
                    card.querySelector('.card-front').appendChild(imageIcon);
                }
                card.addEventListener('click', () => openModal(item));
                diaryGrid.appendChild(card);
            });
        }
        
        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Add event listener to close the completion modal
        completionModal.addEventListener('click', (e) => {
            if (e.target === completionModal || e.target.tagName === 'A') {
                closeCompletionModal();
            }
        });

        toggleBtn.addEventListener('click', () => {
            const isExpanded = expandableContent.classList.contains('max-h-screen');
            if (isExpanded) {
                expandableContent.classList.remove('max-h-screen');
                toggleBtn.textContent = 'é–±è®€æ›´å¤š â–¼';
            } else {
                expandableContent.classList.add('max-h-screen');
                toggleBtn.textContent = 'æ”¶èµ· â–²';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderGrid();
            updateProgressDisplay();
        });
    </script>
</body>
</html>
